<include file="public@header"/>
<include file="admin_goods/pic-list" />

</head>
<body>
<div class="wrap js-check-wrap">
    <ul class="nav nav-tabs">
        <li><a href="{:url('AdminGoods/index')}">商品管理</a></li>
        <li class="active"><a href="javascript:void(0);">添加商品</a></li>
    </ul>
    <div class="row margin-top-20">
        <div class="col-md-1">
            <div class="list-group">
                <a class="list-group-item" href="#BASE_" data-toggle="tab">基本属性</a>
                <!-- 与下面的扩展属性  -->
                <a class="list-group-item" href="#EXT_" data-toggle="tab">扩展属性</a>
                <a class="list-group-item" href="#SEO_" data-toggle="tab">SEO设置</a>
            </div>
        </div>
        <form class="js-ajax-form" action="{:url('AdminGoods/addPost')}" method="post">
        <div class="col-md-8">
            <div class="tab-content">
                <!-- 基本属性S -->
                <div class="tab-pane active" id="BASE_">
                    <include file="admin_goods/BASE_" />
                </div>
                <!-- 基本属性E -->

                <!-- 所有属性S -->
                <div class="tab-pane " id="EXT_">
                    <include file="admin_goods/EXT_" />
                </div>
                <!-- 所有属性E -->

                <div class="tab-pane" id="SEO_">
                    <include file="admin_goods/SEO_" />
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <include file="admin_goods/right" />
        </div>
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <button type="submit" class="btn btn-primary js-ajax-submit">{:lang('ADD')}</button>
                <a class="btn btn-default" href="javascript:history.back(-1);">{:lang('BACK')}</a>
            </div>
        </div>
        </form>
    </div>
</div>
<script type="text/javascript" src="__STATIC__/js/admin.js"></script>
<script type="text/javascript">
    //编辑器路径定义
    var editorURL = GV.WEB_ROOT;
</script>
<script type="text/javascript" src="__STATIC__/js/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="__STATIC__/js/ueditor/ueditor.all.min.js"></script>
<script type="text/javascript">
    $(function () {
        editorcontent = new baidu.editor.ui.Editor();
        editorcontent.render('content');
        try {
            editorcontent.sync();
        } catch (err) {
        }

        $('.btn-cancel-driving_license').click(function () {
            $('#driving_license-preview').attr('src', '__TMPL__/public/assets/images/default-thumbnail.png');
            $('#driving_license').val('');
        });

        $('.btn-cancel-thumbnail').click(function () {
            $('#thumbnail-preview').attr('src', '__TMPL__/public/assets/images/default-thumbnail.png');
            $('#thumbnail').val('');
        });

        $('#input-brand').change(function() {
            var bid = $(this).val();
            $.post("{:url('Ajax/serieByBrand')}", {brandId:bid,option:false}, function(data) {
                var key;
                var tpl = '<option value="">--请选择--</option>';
                for(key in data){
                    tpl += '<option value="'+data[key].id+'">'+data[key].name+'</option>';
                }
                $('#input-series').html(tpl);
                $('#input-serie').hide().html();
            },'json');
        });

        $('#input-province').change(function() {
            var pid = $(this).val();
            $.ajax({
                url: '{:url("Ajax/getCitys")}',
                type: 'POST',
                // dataType: 'json',
                data: {parentId: pid},
            })
            .done(function(data) {
                // console.log("success");
                if (data) {$('#input-city').show().html(data);}
            })
            .fail(function() {
                // console.log("error");
            })
            .always(function() {
                // console.log("complete");
            });
        });

        $('#input-series').change(function() {
            var pid = $(this).val();
            $.post('{:url("Ajax/getSecondSeries")}', {parentId: pid}, function(data) {
                if (data) {$('#input-serie').show().html(data);}
            });
        });

    });

    function doSelectCategory() {
        var selectedCategoriesId = $('#js-categories-id-input').val();
        openIframeLayer("{:url('AdminBrand/select')}?ids=" + selectedCategoriesId, '请选择分类', {
            area: ['700px', '400px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                var iframeWin          = window[layero.find('iframe')[0]['name']];
                var selectedCategories = iframeWin.confirm();
                if (selectedCategories.selectedCategoriesId.length == 0) {
                    layer.msg('请选择分类');
                    return;
                }
                $('#js-categories-id-input').val(selectedCategories.selectedCategoriesId.join(','));
                $('#js-categories-name-input').val(selectedCategories.selectedCategoriesName.join(' '));
                //console.log(layer.getFrameIndex(index));
                layer.close(index); //如果设定了yes回调，需进行手工关闭
            }
        });
    }
</script>
</body>
</html>