<!DOCTYPE html>
<html lang="en">
<head>
    <title>个人中心 - 购物车</title>
    <meta name="keywords" content="{$site_info.site_seo_keywords|default=''}"/>
    <meta name="description" content="{$site_info.site_seo_description|default=''}">

    <include file="public@head"/>
</head>
<body>
    <!-- 头部 -->
    <include file="public@header" />
   

    <!-- 热门资讯 -->
    <section class="person">
        <div class="main">

            <ul class="brash">
                <li>当前位置：</li>
                <li class=""><a href="">服务商城</a></li>
                <li class=""><a href="">配件服务</a></li>
                <li class="active"><a href="#">物流信息</a></li>
            </ul>
            <div class="shops_order">
                <table class='shops-order-tab'>
                        <thead>
                            <tr>
                                <th class='col-pro-img ma-0'><label class='all-sel'><input type="checkbox" class='all-sel-inp'>全选</label></th>
                                <th class='col-pro ma-1'>商品</th>
                                <th class='col-pro ma-2'>市场价</th>
                                <th class='col-pro ma-3'>数量</th>
                                <th class='col-pro ma-4'>单价</th>
                                <th class='col-pro ma-5'>总计</th>
                                <th class='col-pro ma-6'>操作</th>
                            </tr>
                        </thead>
                </table>
                <table class='shops-order-tab'>
                    <tbody class='order-list'>
                        <tr class='order-list-tit'>
                            <td class=' ma-0'><input type="checkbox" class='sel-checkbox'></td>
                            <td class=' ma-1' colspan='5'>
                                <span class="time">2018-01-10 09:40:22</span>
                                <span class="order-goods">
                                    订单号：<a href="">201801100940222779</a>
                                </span>
                            </td>
                            <td class=' ma-6'>待支付</td>
                        </tr>
                        <tr class='order-list-con'>
                            <td class='ma-0'></td>
                            <td class='ma-1'>
                                <div class="order-img">
                                    <a href="">
                                        <img src="http://hcsinglyshop.wincomtech.cn/Public/upload/goods/thumb/45/goods_thumb_45_78_78.jpeg" alt="">
                                    </a>
                                </div>
                                <div class="order-intro">
                                    <div class='order-trade-name'>
                                        <a href="">华为 HUAWEI C199S 麦芒3S 电信4G智能手机FDD-LTE /TD-LTE/CDMA2000/GSM（麦芒）</a>
                                    </div>
                                    <div class='order-attributes'>
                                        <span>颜色分类：倍量加强版【苹果6电池】-送整套拆机工具+视频教程+质保3年</span>
                                    </div>
                                </div>
                                
                            </td>
                            <td class='ma-2'>￥<span class='original'> 1999.00</span></td>
                            <td class='ma-3'>
                                <div class="amout-num">
                                    <span class='btn-reduce'>-</span>
                                    <span class='amoutNum'><input type="text" value='1' class='amoutNum-inp' readonly></span>
                                    <span class='btn-add'>+</span>
                                </div>
                            </td>
                            <td class='ma-4'>
                                <span class='unit-price'>
                                    1500
                                </span> 
                            </td>
                            <td class='ma-5'>
                                <span class='tot-pri'>6000</span>
                            </td>
                            <td class='ma-6'>
                                <div class="order-state group-a">
                                    <a href="javascript:void(0);" class='btn-style backg-red remove-order'>删除</a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <table class='shops-order-tab'>
                    <tbody class='order-list'>
                        <tr class='order-list-tit'>
                            <td class=' ma-0'><input type="checkbox" class='sel-checkbox'></td>
                            <td class=' ma-1' colspan='5'>
                                <span class="time">2018-01-10 09:40:22</span>
                                <span class="order-goods">
                                    订单号：<a href="">201801100940222779</a>
                                </span>
                            </td>
                            <td class=' ma-6'>待支付</td>
                        </tr>
                        <tr class='order-list-con'>
                            <td class='ma-0'></td>
                            <td class='ma-1'>
                                <div class="order-img">
                                    <a href="">
                                        <img src="http://hcsinglyshop.wincomtech.cn/Public/upload/goods/thumb/45/goods_thumb_45_78_78.jpeg" alt="">
                                    </a>
                                </div>
                                <div class="order-intro">
                                    <div class='order-trade-name'>
                                        <a href="">华为 HUAWEI C199S 麦芒3S 电信4G智能手机FDD-LTE /TD-LTE/CDMA2000/GSM（麦芒）</a>
                                    </div>
                                    <div class='order-attributes'>
                                        <span>颜色分类：倍量加强版【苹果6电池】-送整套拆机工具+视频教程+质保3年</span>
                                    </div>
                                </div>
                                
                            </td>
                            <td class='ma-2'>￥<span class='original'> 1999.00</span> </td>
                            <td class='ma-3'>
                                <div class="amout-num">
                                    <span class='btn-reduce'>-</span>
                                    <span class='amoutNum'><input type="text" value='1' class='amoutNum-inp' readonly></span>
                                    <span class='btn-add'>+</span>
                                </div>
                            </td>
                            <td class='ma-4'>
                                <span class='unit-price'>
                                    1500.57
                                </span> 
                            </td>
                            <td class='ma-5'>
                                <span class='tot-pri'>6000</span>
                            </td>
                            <td class='ma-6'>
                                <div class="order-state group-a">
                                    <a href="javascript:void(0);" class='btn-style backg-red remove-order'>删除</a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="total-div">
                    <p >
                        <span >已选商品：</span>
                        <span><i class='totalNum'>2</i> 件</span>
                    </p>
                    <!-- <p >
                        <span >共优惠：</span>
                        <span class='favourable'>700元</span>
                    </p> -->
                    <p >
                        <span >总计金额：</span>
                        <span><b class='orage-color totalPri'>1500.00</b>元</span>
                    </p>
                </div>
            </div>
            <div class="shops_order_m">
                <div class='shops-order-m-div'>
                        <div class='order-list'>
                            <dl class='order-list-tit'>
                                <dd class='mess'>
                                    <label class='all-sel'><input type="checkbox" class='all-sel-inp'>全选</label>
                                    <span class="order-goods">
                                        订单号：<a href="">201801100940222779</a>
                                    </span>
                                </dd>
                                <dd class='states'><a class='editor'>bbbbbb</a></dd>
                            </dl>
                        </div>
                        <div class='order-list-con'>
                            <div class='order-mess'>
                                <div class="order-img">
                                    <a href="">
                                        <img src="http://hcsinglyshop.wincomtech.cn/Public/upload/goods/thumb/45/goods_thumb_45_78_78.jpeg" alt="">
                                    </a>
                                </div>
                                <div class="order-intro">
                                    <div class='order-trade-name'>
                                        <a href="">华为 HUAWEI C199S 麦芒3S 电信4G智能手机FDD-LTE /TD-LTE/CDMA2000/GSM（麦芒）</a>
                                    </div>
                                    <div class='order-attributes'>
                                        <span>颜色分类：倍量加强版【苹果6电池】-送整套拆机工具+视频教程+质保3年</span>
                                    </div>
                                </div>
                                <div class="item-pay">
                                    <p class='price'>1500.00</p>
                                    <p class='price'><del>1000000.00</del></p>
                                    <p class='amount small'>1</p>
                                </div>
                                <!-- mobile  -->
                                <div class="item-editor">
                                    <div class="amout-num">
                                        <span class='btn-reduce'>-</span>
                                        <span class='amoutNum'><input type="text" value='1' class='amoutNum-inp' readonly></span>
                                        <span class='btn-add'>+</span>
                                    </div>
                                    <div class="opeat-btn backg-red">
                                        <span >删除</span>
                                    </div>
                                </div>
                            </div>
                            
                            <dl class='o-total-price'>
                                <span>总计共<b>1</b>件商品</span>
                                <span>合计:<b>￥688.00</b>元</span>
                                <span>含运费（<b>0.00</b>）</span>
                            </dl>
                            
                            <div class='o-tab-btn'>
                                <a class='backg-border '>查看物流</a>
                                <a class='backg-border '>取消订单</a>
                                <a class='backg-border '>取消订单</a>
                                <a class='backg-border '>取消订单</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div> 
        </div>
    </section>

    <!-- 底部 -->
    <include file="public@footer" />
    <include file="public@scripts" />
       
</body>
<include file="public@morejs" />
<script>
    // 购物车
    // 删除
    $('.remove-order').click(function(){
        $(this).parents('table').remove();
        totalNum();
        totalPri();
        favourable();
    })

    $('.btn-add').click(function(){

        $(this).siblings('.amoutNum').children('.amoutNum-inp').val()
        var amount= $(this).siblings('.amoutNum').children('.amoutNum-inp').val();
        var unit_price = $(this).parent().parent().siblings().children('.unit-price').html();
        var tot_pri = $(this).parent().parent().siblings().children('.tot-pri').html();
        var original=$(this).parents('table').find('.original').text();
        var price_difference=parseFloat(original) - parseFloat(unit_price);
        price_difference=price_difference.toFixed(2);

        amount++;
        tot_pri=parseFloat(amount*unit_price).toFixed(2);

        $(this).siblings('.amoutNum').children('.amoutNum-inp').val(amount);
        $(this).parent().parent().siblings().children('.tot-pri').html(tot_pri);
        totalNum();
        totalPri();
        favourable();
    })

    $('.btn-reduce').click(function(){
        $(this).siblings('.amoutNum').children('.amoutNum-inp').val()
        var amount= $(this).siblings('.amoutNum').children('.amoutNum-inp').val();
        var unit_price = $(this).parent().parent().siblings().children('.unit-price').html();
        var tot_pri = $(this).parent().parent().siblings().children('.tot-pri').html();
        var original=$(this).parents('table').find('.original').text();
        var price_difference=parseFloat(original) - parseFloat(unit_price);
        price_difference=price_difference.toFixed(2);
        favourable=price_difference*parseInt(amount);
        console.log(price_difference)

        if(amount>1){
            amount--;
            tot_pri=parseFloat(amount*unit_price).toFixed(2);
            $(this).siblings('.amoutNum').children('.amoutNum-inp').val(amount);
            $(this).parent().parent().siblings().children('.tot-pri').html(tot_pri);
        }else{
           
        }
        totalNum();
        totalPri();
        favourable();
    })

    // 全选

    $('.all-sel-inp').click(function(){
        if($(this).attr('checked')){
            $('.sel-checkbox').prop('checked',true);
            $('.sel-checkbox').parents('table').addClass('sel');
            totalNum();
            totalPri();
            favourable();
        }else{
            $('.sel-checkbox').prop('checked',false);
            $('.totalNum').html(parseInt(0))
            $('.totalPri').html(parseInt(0))
        }
    })

    // 单选
    $('.sel-checkbox').click(function(){
        if(!$(this).prop('checked')){
            $('.all-sel-inp').prop('checked',false);
            $(this).parents('table').removeClass('sel')
        }else{
            $(this).parents('table').addClass('sel')
        }
        totalNum();
        totalPri();
        favourable();
    })

    // 总数量
    function totalNum(){
        // 被选中数量
        if($('.shops-order-tab').hasClass('sel')){
            var tab_inp=$('.sel .amoutNum-inp').map(function(){  
                return $(this).val();  
            }).get();
            
            var sum=tab_inp.reduce(function(x ,y){return   parseFloat(x) + parseFloat(y)})
           $('.totalNum').html(sum)
        }else{
            $('.totalNum').html(parseInt(0))
        }
    }

    //   总价
    function totalPri(){
        if($('.shops-order-tab').hasClass('sel')){
            var tab_span=$('.sel .tot-pri').map(function(){  
                return $(this).text(); 
            }).get();
            var totPrice=tab_span.reduce(function(x ,y){return   parseFloat(x)+parseFloat(y)});
            totPrice=parseFloat(totPrice).toFixed(2)
           $('.totalPri').html(totPrice)
        }else{
            $('.totalPri').html(parseInt(0))
        }
    }
    // 优惠
    // function favourable(){

       
    //     if($('.shops-order-tab').hasClass('sel')){
    //         // var original=$(this).parents('table').find('.original').text();
    //         // var  preferential=$(this).parents('table').find('.unit-price').text();
    //         // var  quantity=$(this).parents('table').find('.amoutNum-inp').val();
    //         // var price_difference=parseFloat(original) - parseFloat(preferential);
    //         // price_difference=price_difference.toFixed(2);
    //         // var favourable=price_difference*quantity;
    //         // console.log(favourable)

    //         console.log( price_difference)
            
    //     }
    // }
</script>
</html>