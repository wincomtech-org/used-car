<!DOCTYPE html>
<html lang="en">
<head>
    <title>菜鸟验车 - {$site_info.site_name|default=''}</title>
    <meta name="keywords" content="{$site_info.site_seo_keywords|default=''}"/>
    <meta name="description" content="{$site_info.site_seo_description|default=''}">

    <include file="public@head"/>
    <hook name="before_head_end"/>

    <!-- 地图样式 -->
   <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=x87CLuOuBaZ0Pet6KMjnTQKKl0zPO7Ku"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.js"></script>
    <link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.css" />
    <!-- 结束地图样式 -->

    <style type="text/css">
        .pic-list li {
            margin-bottom: 5px;
        }
    </style>
    <script type="text/html" id="identity_card-item-tpl">
        <li id="saved-identity_card{id}">
            <input id="identity_card-{id}" type="hidden" name="identity_card[urls][]" value="{filepath}">
            <img id="identity_card-{id}-preview" src="{url}" style="height:108px;width:180px;"
                 onclick="imagePreviewDialog(this.src);">
            <a href="javascript:uploadOneImage('图片上传','#identity_card-{id}');">替换</a>
            <a href="javascript:(function(){$('#saved-identity_card{id}').remove();})();">移除</a>
            <input class="form-control" id="identity_card-{id}-name" type="text" name="identity_card[names][]" value="{name}"
                 title="图片名称">
        </li>
    </script>
</head>
<body>
    <!-- 头部 -->
    <include file="public@header" />
    <!-- 导航 -->
    <include file="public@nav" />

    <!-- 预约 -->
    <section class="selection_insurance">
        <div class="main">
            <ul class="brash">
                <li>当前位置：</li>
                <li><a href="{:url('Index/index')}">检车预约 </a></li>
                <li><a href="{:url('Post/index',['compId'=>$compId])}">{$companyInfo} </a></li>
                <li class="active"><a href="{:url('Post/appoint',['compId'=>$compId,'servId'=>$servId])}">{$servInfo.name}</a></li>
            </ul>
            <div class="selection_insurance_con">
                <form action="{:url('Post/appointPost')}" method="post" enctype="multipart/form-data" name="car_booking_form" class="data_filling" id="data_filling">
                    <foreach name="new_data" item="vo">
                        <ul class="data_filling_list required">
                            <li class="left">{$vo.title}</li>
                            <!-- <li class="right required"> -->
                            <!-- <li class="right required date"> -->
                            <li class="right">
                                <switch name="vo.name">
                                    <case value="plateNo" break="1">
                                        <input type="text" name="post[{$vo.name}]" maxlength="7" required>
                                    </case>
                                    <case value="telephone">
                                        <input type="tel" name="post[{$vo.name}]" maxlength="15" required>
                                        <i>请填写正确的号码，如是固话，请按照格式：0551-1234567</i>
                                        <!-- <b class="red">*请填写正确号码，如是固话，请按照0551-1234567格式</b> -->
                                    </case>
                                    <case value="appoint_time|reg_time|birthday|seller_birthday">
                                        <input type="text" name="post[{$vo.name}]" id="{$vo.name}" required>
                                        <i>请填写正确的日期，按照格式：2017-11-11</i>
                                    </case>
                                    <case value="driving_license|qualified|loan_invoice">
                                        <div class="file">
                                            <input type="hidden" name="post[more][{$vo.name}]" id="{$vo.name}" value="">
                                            <a href="javascript:uploadOneImage('图片上传','#{$vo.name}');" class="demonstrate_pre">
                                                <img src="__TMPL__/public/assets/images/add.png"
                                                     id="{$vo.name}-preview"
                                                      style="cursor: pointer;max-width:200px;"/>
                                                <i class="photo_tip">请上传{$vo.title}照片，不宜过大</i>
                                            </a>
                                           <div class="demonstrate">
                                                <div class="demonstrate_img">
                                                    <img src="__TMPL__/public/assets/images/example/5.jpg" alt="">
                                           
                                                </div>
                                                <i class="photo_tip">请按照上图样式上传图片</i>
                                            </div>
                                        </div>
                                    </case>
                                    <case value="identity_card">
                                        <div class="file">
                                            <ul id="identity_card" class="pic-list list-unstyled form-inline"></ul>
                                            <a href="javascript:uploadMultiImage('图片上传','#identity_card','identity_card-item-tpl');"
                                               class="btn btn-default btn-sm demonstrate_pre">
                                                    <img src="__TMPL__/public/assets/images/add.png"
                                                      style="cursor: pointer:"/>
                                                      <i class='photo_tip'>请上传{$vo.title}照片，不宜过大</i>
                                             </a>
                                             <div class="demonstrate sf">
                                                <div class="demonstrate_img">
                                                    <img src="__TMPL__/public/assets/images/example/6.jpg" alt="">
                                                    <img src="__TMPL__/public/assets/images/example/7.jpg" alt="">
                                                </div>
                                                <i class="photo_tip">请按照上图样式上传图片</i>
                                            </div>  
                                            
                                        </div>
                                    </case>
                                    <case value="service_point">
                                        <select name="more[province_id]" id="input-province" >
                                            <option value="" >--请选择省份--</option>
                                            {$Provinces}
                                        </select>&nbsp;&nbsp;
                                        <select name="more[city_id]" id="input-city">
                                            <option value="">--请选择城市--</option>
                                        </select>&nbsp;&nbsp;

                                        <select name="post[service_point]" id="input-coordinate">
                                            <option value="">--请选择--</option>
                                            <notempty name="servicePoint">
                                            <foreach name="servicePoint" item="vo">
                                            <option value="{$vo.id}">{$vo.name}</option>
                                            </foreach>
                                            </notempty>
                                        </select>
                                    </case>
                                    <default /><input type="text" name="post[{$vo.name}]" required>
                                </switch>
                            </li>
                        </ul>
                    </foreach>
                    <p class="data_filling_btn">
                        <input type="hidden" name="post[model_id]" value="{$servId}">
                        <input type="hidden" name="compId" value="{$compId}">
                        <input type="submit" name="data_filling_online" class="btn_submit" value='立即预约' onClick="car_booking_form.submit()">
                    </p>
                </form>
                <div class="map_con" >
                    <div id="allmap"></div>
                    <style type="text/css">
                        #allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
                        #l-map{height:100%;width:78%;float:left;border-right:2px solid #bcbcbc;}
                        #r-result{height:100%;width:20%;float:left;}
                    </style>
                    <script type="text/javascript">
                        // 百度地图API功能
                        var map = new BMap.Map("allmap",{minZoom:10,maxZoom:16});
                        var point = new BMap.Point(117.281736,31.87001);
                        map.centerAndZoom(point, 15);
                        map.enableScrollWheelZoom(true);
                        var searchInfoWindow = null;
                        var opts={};

                        // 随机向地图添加多个标注
                        console.log('{$servicePointJson}');
                        // for (var i = 0; i < Things.length; i++) {
                        //     Things[i]
                        // }
                        var z=[
                            [117.233443,31.836578,"地址：12",'电话：0551-111','简介：111。','标题1','分部1','合肥'],
                            [117.243443,31.826578,"地址：666",'电话：0551-222','简介：222。','标题2','分部2','合肥'],
                            [117.253443,31.821578,"地址：777",'电话：0551-333','简介：333','标题3','分部3','合肥'],
                            [117.263443,31.806578,"地址：888",'电话：0551-444','简介：444','标题4','分部4','合肥']
                        ]
                        for (var i = 0; i < z.length; i ++) {
                            var point = new BMap.Point(z[i][0], z[i][1]);
                            /*定义小图标*/
                            var myIcon = new BMap.Icon("http://api.map.baidu.com/img/markers.png", new BMap.Size(23, 25), {
                                offset: new BMap.Size(10, 25),
                                imageOffset: new BMap.Size(0, 0 - i * 25)
                            });

                            var marker = new BMap.Marker(point, {icon: myIcon});
                            var content =
                            '<div class="map_div" style="margin:0;line-height:20px;padding:2px;" to="http://api.map.baidu.com/">' +
                                '<img src="../img/baidu.jpg" alt="" style="float:right;zoom:1;overflow:hidden;width:100px;height:100px;margin-left:3px;"/>' +
                                z[i][2]+'<br/>'+z[i][3]+'<br/>'+z[i][4] +
                            '</div>'+
                            '<form id="gotobaiduform" action="http://api.map.baidu.com/direction" target="_blank" method="get">'+
                                '<span class="input">'+
                                    '<strong>起点：</strong>'+
                                    '<input class="outset" type="text" name="origin" value="合肥站" />'+
                                    '<input class="outset-but" type="button" value="公交" onclick="gotobaidu(1)" />'+
                                    '<input class="outset-but" type="button" value="驾车" onclick="gotobaidu(2)" />'+
                                    '<a class="gotob"'+ 'href="url='+'"http://api.map.baidu.com/direction?destination=latlng:'+marker.getPosition().lat+"," +  marker.getPosition().lng+ '|name:'+  z[i][6] + '®ion='+z[i][7]+'&output=html"'+ 'target="_blank"></a>"'+
                                '</span>'+
                                '<input type="hidden" value="'+z[i][7]+'" name="region" />'+
                                '<input type="hidden" value="html" name="output" />'+
                                '<input type="hidden" value="driving" name="mode" />'+
                                '<input type="hidden" value="latlng:' +  marker.getPosition().lat + "," + marker.getPosition().lng + '|name:' + z[i][6]+ '"' +' name="destination" />'+
                            '</form>'

                            opts = {
                                enableMessage:false,
                                title  : z[i][5],      //标题
                                width  : 290,             //宽度
                                height : 105,              //高度
                                panel  : "panel",         //检索结果面板
                                enableAutoPan : true,     //自动平移
                                searchTypes   :[
                                ]
                            };

                            map.addOverlay(marker); //在地图中添加marker
                            addClickHandler(content,opts,marker);
                        }

                        function gotobaidu(type)
                        {
                            if($.trim($("input[name=origin]").val())=="")
                            {
                                alert("请输入起点！");
                                return;
                            }else{
                                if(type==1)
                                {
                                    $("input[name=mode]").val("transit");
                                    $("#gotobaiduform")[0].submit();
                                }else if(type==2)
                                {
                                    $("input[name=mode]").val("driving");
                                    $("#gotobaiduform")[0].submit();
                                }
                            }
                        }

                        function addClickHandler(content,opts,marker){
                            marker.addEventListener("click",function(e){
                                 searchInfoWindow = new BMapLib.SearchInfoWindow(map, content,opts)
                                 searchInfoWindow.open(marker);
                            })
                        }
                    </script>
                </div>
            </div>
        </div>
    </section>

    <!-- 底部 -->
    <include file="public@footer" />
    <include file="public@scripts" />
    <hook name="before_body_end" />
</body>
<script type="text/javascript" src="__TMPL__/public/assets/js/laydate/laydate.js"></script>
<script src="__TMPL__/public/assets/js/Area.js" type="text/javascript"></script>
<script src="__TMPL__/public/assets/js/AreaData_min.js" type="text/javascript"></script>

<script>
    $(function(){
        /**日期时间**/
        var date=new Date();
        var date_year=date.getFullYear()
        var date_month=date.getMonth()+1
        var date_day=date.getDate();
        var now_date=date_year + "-" + date_month +"-" +date_day;
        var date_var = ['appoint_time','birthday','seller_birthday','reg_time'];
        for (var i = 0; i < date_var.length; i++) {
            laydate.render({
                elem: '#'+date_var[i],
                value: now_date
            });
        }

        /**出生日期: 买家和卖家两个遍历**/
        // lay('.birthday').each(function(){
        //     laydate.render({
        //         elem: this
        //         ,trigger: 'click'
        //     });
        // });

        // 地区选项
        $('#input-province').change(function() {
            // var o = this = '#input-province';
            var url = '{:url("usual/Ajax/getCitys")}';
            select_province(this,url);

            var Id = $(this).val();
            $.post('{:url("usual/Ajax/coordinate")}', {compId:'{$compId}', provId: Id}, function(coord) {
                $('#input-coordinate').html(coord);
            });
        });

        $('#input-city').change(function() {
            var provId = $('#input-province').val(),cityId = $(this).val();
            $.post('{:url("usual/Ajax/coordinate")}', {compId:'{$compId}', provId: provId, cityId: cityId}, function(coord) {
                $('#input-coordinate').html(coord);
            });
        });


    });
</script>
</script>
</html>