<!DOCTYPE html>
<html lang="en">
<head>
<title>菜鸟验车 - {$site_info.site_name|default=''}</title>
<meta name="keywords" content="{$site_info.site_seo_keywords|default=''}"/>
<meta name="description" content="{$site_info.site_seo_description|default=''}">

<include file="public@head"/>
<hook name="before_head_end"/>

<style type="text/css">
    .pic-list li {
        margin-bottom: 5px;
    }
</style>
<script type="text/html" id="identity_card-item-tpl">
    <li id="saved-identity_card{id}">
        <input id="identity_card-{id}" type="hidden" name="identity_card[urls][]" value="{filepath}">
        <img id="identity_card-{id}-preview" src="{url}" style="height:108px;width:180px;"
             onclick="imagePreviewDialog(this.src);">
        <a href="javascript:uploadOneImage('图片上传','#identity_card-{id}');">替换</a>
        <a href="javascript:(function(){$('#saved-identity_card{id}').remove();})();">移除</a>
        <input class="form-control" id="identity_card-{id}-name" type="text" name="identity_card[names][]" value="{name}"
             title="图片名称">
    </li>
</script>
</head>
<body>
<!-- 头部 -->
<include file="public@header" />
<!-- 导航 -->
<include file="public@nav" />

<!-- 预约 -->
<section class="selection_insurance">
    <div class="main">
        <ul class="brash">
            <li>当前位置：</li>
            <li><a href="{:url('Index/index')}">检车预约 </a></li>
            <li><a href="{:url('Post/index',['compId'=>$compId])}">{$companyInfo} </a></li>
            <li class="active"><a href="{:url('Post/appoint',['compId'=>$compId,'servId'=>$servId])}">{$servInfo.name}</a></li>
        </ul>
        <div class="selection_insurance_con">
            <form action="{:url('Post/appointPost')}" method="post" enctype="multipart/form-data" name="car_booking_form" class="data_filling" id="data_filling">
                <foreach name="new_data" item="vo">
                    <ul class="data_filling_list required">
                        <li class="left">{$vo.title}</li>
                        <!-- <li class="right required"> -->
                        <!-- <li class="right required date"> -->
                        <li class="right">
                            <switch name="vo.name">
                                <case value="plateNo" break="1">
                                    <input type="text" name="post[{$vo.name}]" maxlength="7" required>
                                </case>
                                <case value="telephone">
                                    <input type="tel" name="post[{$vo.name}]" maxlength="15" required>
                                    <i>请填写正确的号码，如是固话，请按照格式：0551-1234567</i>
                                    <!-- <b class="red">*请填写正确号码，如是固话，请按照0551-1234567格式</b> -->
                                </case>
                                <case value="appoint_time|reg_time|birthday|seller_birthday">
                                    <input type="text" name="post[{$vo.name}]" id="{$vo.name}" required>
                                    <i>请填写正确的日期，按照格式：2017-11-11</i>
                                </case>
                                <case value="driving_license|qualified|loan_invoice">
                                    <div class="file">
                                        <input type="hidden" name="post[more][{$vo.name}]" id="{$vo.name}" value="">
                                        <a href="javascript:uploadOneImage('图片上传','#{$vo.name}');" class="demonstrate_pre">
                                            <img src="__TMPL__/public/assets/images/add.png"
                                                 id="{$vo.name}-preview"
                                                  style="cursor: pointer;max-width:200px;"/>
                                            <i class="photo_tip">请上传{$vo.title}照片，不宜过大</i>
                                        </a>
                                       <div class="demonstrate">
                                            <div class="demonstrate_img">
                                                <img src="__TMPL__/public/assets/images/example/5.jpg" alt="">
                                            </div>
                                            <i class="photo_tip">请按照上图样式上传图片</i>
                                        </div>
                                    </div>
                                </case>
                                <case value="identity_card">
                                    <div class="file">
                                        <ul id="identity_card" class="pic-list list-unstyled form-inline"></ul>
                                        <a href="javascript:uploadMultiImage('图片上传','#identity_card','identity_card-item-tpl');"
                                           class="btn btn-default btn-sm demonstrate_pre">
                                                <img src="__TMPL__/public/assets/images/add.png"
                                                  style="cursor: pointer:"/>
                                                  <i class='photo_tip'>请上传{$vo.title}照片，不宜过大</i>
                                         </a>
                                         <div class="demonstrate sf">
                                            <div class="demonstrate_img">
                                                <img src="__TMPL__/public/assets/images/example/6.jpg" alt="">
                                                <img src="__TMPL__/public/assets/images/example/7.jpg" alt="">
                                            </div>
                                            <i class="photo_tip">请按照上图样式上传图片</i>
                                        </div>
                                    </div>
                                </case>
                                <case value="service_point">
                                    <select name="more[province_id]" id="input-province" >
                                        <option value="" >--请选择省份--</option>
                                        {$Provinces}
                                    </select>&nbsp;&nbsp;
                                    <select name="more[city_id]" id="input-city">
                                        <option value="">--请选择城市--</option>
                                    </select>&nbsp;&nbsp;

                                    <select name="post[service_point]" id="input-coordinate">
                                        <option value="">--请选择--</option>
                                        <notempty name="servicePoint">
                                        <foreach name="servicePoint" item="vo">
                                        <option value="{$vo.id}">{$vo.name}</option>
                                        </foreach>
                                        </notempty>
                                    </select>
                                </case>
                                <default /><input type="text" name="post[{$vo.name}]" required>
                            </switch>
                        </li>
                    </ul>
                </foreach>
                <p class="data_filling_btn">
                    <input type="hidden" name="post[model_id]" value="{$servId}">
                    <input type="hidden" name="compId" value="{$compId}">
                    <input type="submit" name="data_filling_online" class="btn_submit" value='立即预约' onClick="car_booking_form.submit()">
                </p>
            </form>
            <notempty name="servicePointJson">
            <div class="map_con" >
                <div id="allmap"></div>
               <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=x87CLuOuBaZ0Pet6KMjnTQKKl0zPO7Ku"></script>
                <script type="text/javascript" src="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.js"></script>
                <!-- 地图样式 -->
                <link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.css" />
                <!-- 结束地图样式 -->
                <style type="text/css">
                    #allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
                    #l-map{height:100%;width:78%;float:left;border-right:2px solid #bcbcbc;}
                    #r-result{height:100%;width:20%;float:left;}
                </style>
                <!-- 引入相关方法 -->
                <script src="__STATIC__/js/baidumap.js"></script>
                <script type="text/javascript">
                $(function(){
                    // 百度地图API功能 页面加载时

                    // 起始点
                    var default_point = [117.281736,31.87001];

                    // 随机向地图添加多个标注
                    // $.getJSON("{:url('usual/Ajax/coords')}", data, success);
                    var json_data = '{$servicePointJson}';
                    // console.log(json_data);
                    var data = $.parseJSON(json_data);

                    // for (var i = 0; i < data.length; i++) {
                    //     data[i]
                    // }

                    // var data = [
                    //     [117.233443,31.836578,"地址：12",'电话：0551-111','简介：111。','标题1','分部1','合肥'],
                    //     [117.243443,31.826578,"地址：666",'电话：0551-222','简介：222。','标题2','分部2','合肥'],
                    //     [117.253443,31.821578,"地址：777",'电话：0551-333','简介：333','标题3','分部3','合肥'],
                    //     [117.263443,31.806578,"地址：888",'电话：0551-444','简介：444','标题4','分部4','合肥']
                    // ];

                    setMapIni(default_point);
                    createCoords(data);
                });
                </script>
            </div>
            </notempty>
        </div>
    </div>
</section>

<!-- 底部 -->
<include file="public@footer" />
<include file="public@scripts" />
<hook name="before_body_end" />
</body>
<script type="text/javascript" src="__TMPL__/public/assets/js/laydate/laydate.js"></script>
<!-- <script src="__TMPL__/public/assets/js/Area.js" type="text/javascript"></script>
<script src="__TMPL__/public/assets/js/AreaData_min.js" type="text/javascript"></script> -->

<script>
$(function(){
    /**日期时间**/
    var date=new Date();
    var date_year=date.getFullYear()
    var date_month=date.getMonth()+1
    var date_day=date.getDate();
    var now_date=date_year + "-" + date_month +"-" +date_day;
    var date_var = ['appoint_time','birthday','seller_birthday','reg_time'];
    for (var i = 0; i < date_var.length; i++) {
        laydate.render({
            elem: '#'+date_var[i],
            value: now_date
        });
    }

    /**出生日期: 买家和卖家两个遍历**/
    // lay('.birthday').each(function(){
    //     laydate.render({
    //         elem: this
    //         ,trigger: 'click'
    //     });
    // });

    // 地区选项
    $('#input-province').change(function() {
        // var o = this = '#input-province';
        var url = '{:url("usual/Ajax/getCitys")}';

        // 地区选择
        select_province('',url);
        // 坐标获取
        var Id = $(this).val();
        var data = {compId:'{$compId}', provId: Id};
        $.post('{:url("usual/Ajax/coordinate")}', data, function(coord) {
            console.log(coord)
            $('#input-coordinate').html(coord);
        });
        // 地图坐标
        $.getJSON("{:url('usual/Ajax/coords')}", data, function(result){
            var json_data = result;
            console.log(json_data);
            var data = $.parseJSON(json_data);
        });
    });

    $('#input-city').change(function() {
        var provId = $('#input-province').val(),cityId = $(this).val();
        $.post('{:url("usual/Ajax/coordinate")}', {compId:'{$compId}', provId: provId, cityId: cityId}, function(coord) {
            $('#input-coordinate').html(coord);
        });
    });


});
</script>
</html>